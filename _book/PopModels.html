<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Integrated Population Models | A Bayesian Introduction to Fish Population Analysis</title>
  <meta name="description" content="This book is intended to be a bridge between traditional fisheries analytical methods and Bayesian statistics. It is a hands-on introduction to models for estimating abundance, survival, growth, and recruitment." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Integrated Population Models | A Bayesian Introduction to Fish Population Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is intended to be a bridge between traditional fisheries analytical methods and Bayesian statistics. It is a hands-on introduction to models for estimating abundance, survival, growth, and recruitment." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Integrated Population Models | A Bayesian Introduction to Fish Population Analysis" />
  
  <meta name="twitter:description" content="This book is intended to be a bridge between traditional fisheries analytical methods and Bayesian statistics. It is a hands-on introduction to models for estimating abundance, survival, growth, and recruitment." />
  

<meta name="author" content="Joseph E. Hightower" />


<meta name="date" content="2025-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Recruit.html"/>
<link rel="next" href="FinalThoughts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bayesian fish population analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software information and conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="R-intro.html"><a href="R-intro.html"><i class="fa fa-check"></i><b>2</b> A Brief Introduction to R and RStudio</a></li>
<li class="chapter" data-level="3" data-path="Distributions.html"><a href="Distributions.html"><i class="fa fa-check"></i><b>3</b> Probability Distributions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Distributions.html"><a href="Distributions.html#Discrete"><i class="fa fa-check"></i><b>3.1</b> Discrete</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="Distributions.html"><a href="Distributions.html#Bernoulli"><i class="fa fa-check"></i><b>3.1.1</b> Bernoulli</a></li>
<li class="chapter" data-level="3.1.2" data-path="Distributions.html"><a href="Distributions.html#BinomialDist"><i class="fa fa-check"></i><b>3.1.2</b> Binomial</a></li>
<li class="chapter" data-level="3.1.3" data-path="Distributions.html"><a href="Distributions.html#Multinomial"><i class="fa fa-check"></i><b>3.1.3</b> Multinomial</a></li>
<li class="chapter" data-level="3.1.4" data-path="Distributions.html"><a href="Distributions.html#PoissonDist"><i class="fa fa-check"></i><b>3.1.4</b> Poisson</a></li>
<li class="chapter" data-level="3.1.5" data-path="Distributions.html"><a href="Distributions.html#NegBinom"><i class="fa fa-check"></i><b>3.1.5</b> Negative binomial</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Distributions.html"><a href="Distributions.html#Continuous"><i class="fa fa-check"></i><b>3.2</b> Continuous</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Distributions.html"><a href="Distributions.html#Uniform"><i class="fa fa-check"></i><b>3.2.1</b> Uniform</a></li>
<li class="chapter" data-level="3.2.2" data-path="Distributions.html"><a href="Distributions.html#BetaDist"><i class="fa fa-check"></i><b>3.2.2</b> Beta</a></li>
<li class="chapter" data-level="3.2.3" data-path="Distributions.html"><a href="Distributions.html#NormalDist"><i class="fa fa-check"></i><b>3.2.3</b> Normal</a></li>
<li class="chapter" data-level="3.2.4" data-path="Distributions.html"><a href="Distributions.html#LognormalDist"><i class="fa fa-check"></i><b>3.2.4</b> Lognormal</a></li>
<li class="chapter" data-level="3.2.5" data-path="Distributions.html"><a href="Distributions.html#GammaDist"><i class="fa fa-check"></i><b>3.2.5</b> Gamma</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Distributions.html"><a href="Distributions.html#exercises"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Model-fit.html"><a href="Model-fit.html"><i class="fa fa-check"></i><b>4</b> Model Fitting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Model-fit.html"><a href="Model-fit.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="Model-fit.html"><a href="Model-fit.html#Model-fit-sim"><i class="fa fa-check"></i><b>4.2</b> Using simulation</a></li>
<li class="chapter" data-level="4.3" data-path="Model-fit.html"><a href="Model-fit.html#JAGS-model-fit"><i class="fa fa-check"></i><b>4.3</b> Using Bayesian methods</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="Model-fit.html"><a href="Model-fit.html#FirstExampleBayesian"><i class="fa fa-check"></i><b>4.3.1</b> Example: mark-recapture</a></li>
<li class="chapter" data-level="4.3.2" data-path="Model-fit.html"><a href="Model-fit.html#Debug"><i class="fa fa-check"></i><b>4.3.2</b> Debugging code</a></li>
<li class="chapter" data-level="4.3.3" data-path="Model-fit.html"><a href="Model-fit.html#Convergence"><i class="fa fa-check"></i><b>4.3.3</b> Judging convergence</a></li>
<li class="chapter" data-level="4.3.4" data-path="Model-fit.html"><a href="Model-fit.html#Likelihood"><i class="fa fa-check"></i><b>4.3.4</b> What is a likelihood?</a></li>
<li class="chapter" data-level="4.3.5" data-path="Model-fit.html"><a href="Model-fit.html#Deviance"><i class="fa fa-check"></i><b>4.3.5</b> Deviance as a measure of model fit</a></li>
<li class="chapter" data-level="4.3.6" data-path="Model-fit.html"><a href="Model-fit.html#Model-checking"><i class="fa fa-check"></i><b>4.3.6</b> Model checking</a></li>
<li class="chapter" data-level="4.3.7" data-path="Model-fit.html"><a href="Model-fit.html#Model-selection"><i class="fa fa-check"></i><b>4.3.7</b> Model selection</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="Model-fit.html"><a href="Model-fit.html#exercises-1"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Abundance.html"><a href="Abundance.html"><i class="fa fa-check"></i><b>5</b> Abundance</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Abundance.html"><a href="Abundance.html#Removal"><i class="fa fa-check"></i><b>5.1</b> Removal</a></li>
<li class="chapter" data-level="5.2" data-path="Abundance.html"><a href="Abundance.html#MarkRecap"><i class="fa fa-check"></i><b>5.2</b> Mark-recapture</a></li>
<li class="chapter" data-level="5.3" data-path="Abundance.html"><a href="Abundance.html#NMix"><i class="fa fa-check"></i><b>5.3</b> Binomial-mixture</a></li>
<li class="chapter" data-level="5.4" data-path="Abundance.html"><a href="Abundance.html#exercises-2"><i class="fa fa-check"></i><b>5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Survival.html"><a href="Survival.html"><i class="fa fa-check"></i><b>6</b> Survival</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Survival.html"><a href="Survival.html#AgeComp"><i class="fa fa-check"></i><b>6.1</b> Age-composition</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="Survival.html"><a href="Survival.html#CC_Selectivity"><i class="fa fa-check"></i><b>6.1.1</b> Accounting For Gear Selectivity</a></li>
<li class="chapter" data-level="6.1.2" data-path="Survival.html"><a href="Survival.html#Cohort"><i class="fa fa-check"></i><b>6.1.2</b> Cohort model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="Survival.html"><a href="Survival.html#TelemetryBased"><i class="fa fa-check"></i><b>6.2</b> Telemetry-based</a></li>
<li class="chapter" data-level="6.3" data-path="Survival.html"><a href="Survival.html#BrownieSurvival"><i class="fa fa-check"></i><b>6.3</b> Tag-based</a></li>
<li class="chapter" data-level="6.4" data-path="Survival.html"><a href="Survival.html#exercises-3"><i class="fa fa-check"></i><b>6.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Mortality.html"><a href="Mortality.html"><i class="fa fa-check"></i><b>7</b> Mortality Components</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Mortality.html"><a href="Mortality.html#ExpRate"><i class="fa fa-check"></i><b>7.1</b> Exploitation rate</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="Mortality.html"><a href="Mortality.html#InformativePriors"><i class="fa fa-check"></i><b>7.1.1</b> Informative prior distribution</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="Mortality.html"><a href="Mortality.html#Hearn"><i class="fa fa-check"></i><b>7.2</b> Completed tagging study</a></li>
<li class="chapter" data-level="7.3" data-path="Mortality.html"><a href="Mortality.html#BrownieFandM"><i class="fa fa-check"></i><b>7.3</b> Multi-year tagging study</a></li>
<li class="chapter" data-level="7.4" data-path="Mortality.html"><a href="Mortality.html#TelemetryFandM"><i class="fa fa-check"></i><b>7.4</b> Telemetry-based</a></li>
<li class="chapter" data-level="7.5" data-path="Mortality.html"><a href="Mortality.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Growth.html"><a href="Growth.html"><i class="fa fa-check"></i><b>8</b> Growth</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Growth.html"><a href="Growth.html#vonBert"><i class="fa fa-check"></i><b>8.1</b> Growth in length</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="Growth.html"><a href="Growth.html#Otolith"><i class="fa fa-check"></i><b>8.1.1</b> Age-length</a></li>
<li class="chapter" data-level="8.1.2" data-path="Growth.html"><a href="Growth.html#GrowthInc"><i class="fa fa-check"></i><b>8.1.2</b> Using tagging data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="Growth.html"><a href="Growth.html#LnWgt"><i class="fa fa-check"></i><b>8.2</b> Growth in weight</a></li>
<li class="chapter" data-level="8.3" data-path="Growth.html"><a href="Growth.html#exercises-5"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Recruit.html"><a href="Recruit.html"><i class="fa fa-check"></i><b>9</b> Recruitment</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Recruit.html"><a href="Recruit.html#Recruit-Fit"><i class="fa fa-check"></i><b>9.1</b> Fitting a stock-recruitment curve</a></li>
<li class="chapter" data-level="9.2" data-path="Recruit.html"><a href="Recruit.html#Recruit-DIC"><i class="fa fa-check"></i><b>9.2</b> Does spawning stock size affect recruitment?</a></li>
<li class="chapter" data-level="9.3" data-path="Recruit.html"><a href="Recruit.html#exercises-6"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="PopModels.html"><a href="PopModels.html"><i class="fa fa-check"></i><b>10</b> Integrated Population Models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="PopModels.html"><a href="PopModels.html#TwoAge"><i class="fa fa-check"></i><b>10.1</b> Two-age model</a></li>
<li class="chapter" data-level="10.2" data-path="PopModels.html"><a href="PopModels.html#CAGEAN"><i class="fa fa-check"></i><b>10.2</b> Full age-structured model</a></li>
<li class="chapter" data-level="10.3" data-path="PopModels.html"><a href="PopModels.html#exercises-7"><i class="fa fa-check"></i><b>10.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="FinalThoughts.html"><a href="FinalThoughts.html"><i class="fa fa-check"></i><b>11</b> Final Thoughts</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="real-data-examples.html"><a href="real-data-examples.html"><i class="fa fa-check"></i><b>A</b> Real-data examples</a>
<ul>
<li class="chapter" data-level="A.1" data-path="real-data-examples.html"><a href="real-data-examples.html#RemovalRealData"><i class="fa fa-check"></i><b>A.1</b> Removal</a></li>
<li class="chapter" data-level="A.2" data-path="real-data-examples.html"><a href="real-data-examples.html#MarkRecapRealData"><i class="fa fa-check"></i><b>A.2</b> Mark-recapture</a></li>
<li class="chapter" data-level="A.3" data-path="real-data-examples.html"><a href="real-data-examples.html#AgeCompRealData"><i class="fa fa-check"></i><b>A.3</b> Age-composition</a></li>
<li class="chapter" data-level="A.4" data-path="real-data-examples.html"><a href="real-data-examples.html#BrownieSurvivalRealData"><i class="fa fa-check"></i><b>A.4</b> Tag-based</a></li>
<li class="chapter" data-level="A.5" data-path="real-data-examples.html"><a href="real-data-examples.html#vonBertRealData"><i class="fa fa-check"></i><b>A.5</b> Growth in length</a></li>
<li class="chapter" data-level="A.6" data-path="real-data-examples.html"><a href="real-data-examples.html#Recruit-FitRealData"><i class="fa fa-check"></i><b>A.6</b> Fitting a stock-recruitment curve</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Bayesian Introduction to Fish Population Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="PopModels" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Integrated Population Models<a href="PopModels.html#PopModels" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The field and analytical methods discussed thus far have addressed population rates one at a time (e.g., estimating abundance or survival). An improved approach would be to design a complementary set of field studies that provides a complete picture of population dynamics. For example, <span class="citation">Conn et al. (<a href="#ref-conn.etal_2008">2008</a>)</span> used harvest and tag recovery data to fit an integrated population model (IPM) for black bear (<em>Ursus americanus</em>). Their model provided estimates that were more precise and biologically realistic than point estimates using capture-recapture data alone. <span class="citation">Kéry and Schaub (<a href="#ref-kéry.schaub_2012">2012</a>)</span> developed an avian IPM using adult population counts, nest surveys, and capture-recapture data on survival. We begin here with a somewhat simpler approach, a two-age model (ages 1 and 2+) using capture-recapture and telemetry data, then examine a full age-structured model as typically used in fish stock assessment (Section <a href="PopModels.html#CAGEAN">10.2</a>).</p>
<div id="TwoAge" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Two-age model<a href="PopModels.html#TwoAge" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This example shows how two independent field studies (capture-recapture estimates of abundance and telemetry information on survival) can be combined to make inferences about population dynamics. The cost of this approach in time and money is higher than a basic relative-abundance survey, but it provides insights about population dynamics (recruitment and survival) that would not be possible with relative abundance data alone. The cost could be justified for a subset of cases; for example, a population at low abundance or one supporting an important fishery. We begin with the simulation model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="PopModels.html#cb1-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co"># Clear Environment</span></span>
<span id="cb1-2"><a href="PopModels.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="PopModels.html#cb1-3" tabindex="-1"></a><span class="co"># Simulation to create population size and field data</span></span>
<span id="cb1-4"><a href="PopModels.html#cb1-4" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-5"><a href="PopModels.html#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="PopModels.html#cb1-6" tabindex="-1"></a>LowS <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># Adult survival, arbitrary lower bound</span></span>
<span id="cb1-7"><a href="PopModels.html#cb1-7" tabindex="-1"></a>HighS <span class="ot">&lt;-</span> <span class="fl">0.9</span> <span class="co"># Arbitrary upper bound</span></span>
<span id="cb1-8"><a href="PopModels.html#cb1-8" tabindex="-1"></a>AnnualS <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span>(Y<span class="dv">-1</span>), <span class="at">min=</span>LowS, <span class="at">max=</span>HighS)</span>
<span id="cb1-9"><a href="PopModels.html#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="PopModels.html#cb1-10" tabindex="-1"></a>MeanR <span class="ot">&lt;-</span> <span class="dv">400</span> <span class="co"># Arbitrary mean annual recruitment</span></span>
<span id="cb1-11"><a href="PopModels.html#cb1-11" tabindex="-1"></a>N.r <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span>Y)</span>
<span id="cb1-12"><a href="PopModels.html#cb1-12" tabindex="-1"></a>V_rec <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Log-scale recruitment variance</span></span>
<span id="cb1-13"><a href="PopModels.html#cb1-13" tabindex="-1"></a>SD_rec <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(V_rec)</span>
<span id="cb1-14"><a href="PopModels.html#cb1-14" tabindex="-1"></a>N.r <span class="ot">&lt;-</span> <span class="fu">trunc</span>(MeanR <span class="sc">*</span> <span class="fu">rlnorm</span>(<span class="at">n=</span>Y, <span class="dv">0</span>, SD_rec))</span>
<span id="cb1-15"><a href="PopModels.html#cb1-15" tabindex="-1"></a>N.a <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span>Y)</span>
<span id="cb1-16"><a href="PopModels.html#cb1-16" tabindex="-1"></a>N.a[<span class="dv">1</span>] <span class="ot">&lt;-</span> N.r[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rpois</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">lambda=</span>MeanR) </span>
<span id="cb1-17"><a href="PopModels.html#cb1-17" tabindex="-1"></a>  <span class="co"># Arbitrary year-1 population size</span></span>
<span id="cb1-18"><a href="PopModels.html#cb1-18" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>Y){</span>
<span id="cb1-19"><a href="PopModels.html#cb1-19" tabindex="-1"></a>  N.a[y] <span class="ot">&lt;-</span> N.r[y] <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span>N.a[y<span class="dv">-1</span>], <span class="at">prob=</span>AnnualS[y<span class="dv">-1</span>])</span>
<span id="cb1-20"><a href="PopModels.html#cb1-20" tabindex="-1"></a>} <span class="co">#y</span></span>
<span id="cb1-21"><a href="PopModels.html#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="PopModels.html#cb1-22" tabindex="-1"></a><span class="co"># Short-term (closed) two-sample population estimate</span></span>
<span id="cb1-23"><a href="PopModels.html#cb1-23" tabindex="-1"></a>CapProb <span class="ot">&lt;-</span> <span class="fl">0.2</span> <span class="co"># Fraction of population sampled</span></span>
<span id="cb1-24"><a href="PopModels.html#cb1-24" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>Y, <span class="at">size=</span>N.a, <span class="at">prob=</span>CapProb) </span>
<span id="cb1-25"><a href="PopModels.html#cb1-25" tabindex="-1"></a>  <span class="co"># Caught and marked in first sample</span></span>
<span id="cb1-26"><a href="PopModels.html#cb1-26" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>Y, <span class="at">size=</span>N.a, <span class="at">prob=</span>CapProb) </span>
<span id="cb1-27"><a href="PopModels.html#cb1-27" tabindex="-1"></a>  <span class="co"># Caught and examined for marks in second sample</span></span>
<span id="cb1-28"><a href="PopModels.html#cb1-28" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>Y, <span class="at">size=</span>n2, <span class="at">prob=</span>n1<span class="sc">/</span>N.a) <span class="co"># Marked fish in second sample</span></span>
<span id="cb1-29"><a href="PopModels.html#cb1-29" tabindex="-1"></a></span>
<span id="cb1-30"><a href="PopModels.html#cb1-30" tabindex="-1"></a><span class="co"># Telemetry information on annual survival</span></span>
<span id="cb1-31"><a href="PopModels.html#cb1-31" tabindex="-1"></a>TelRelease <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># Number of telemetry tags to release annually</span></span>
<span id="cb1-32"><a href="PopModels.html#cb1-32" tabindex="-1"></a>TelTags <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>((Y<span class="dv">-1</span>),Y))</span>
<span id="cb1-33"><a href="PopModels.html#cb1-33" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(Y<span class="dv">-1</span>)){</span>
<span id="cb1-34"><a href="PopModels.html#cb1-34" tabindex="-1"></a>  TelTags[y,y] <span class="ot">&lt;-</span> TelRelease</span>
<span id="cb1-35"><a href="PopModels.html#cb1-35" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> ((y<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>Y)){</span>
<span id="cb1-36"><a href="PopModels.html#cb1-36" tabindex="-1"></a>    TelTags[y,t] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span>TelTags[y,(t<span class="dv">-1</span>)], </span>
<span id="cb1-37"><a href="PopModels.html#cb1-37" tabindex="-1"></a>                           <span class="at">prob=</span>AnnualS[t<span class="dv">-1</span>])</span>
<span id="cb1-38"><a href="PopModels.html#cb1-38" tabindex="-1"></a>  }} <span class="co"># y,t</span></span></code></pre></div>
<p>We model absolute population size, and assume that fish age 1 and older have the same survival rate, which varies annually within user-specified lower and upper bounds. Recruitment (surviving age-0 fish from the prior year) varies annually about an arbitrary mean according to a lognormal distribution (Section <a href="Recruit.html#Recruit-Fit">9.1</a>). We require a starting population in year 1 and draw the adult survivors from a Poisson distribution, using the same mean as recruitment. Population size in subsequent years is</p>
<p><span class="math inline">\(N.a_y = N.r_y + Binomial(N.a_{y-1}, AnnualS_{y-1})\)</span></p>
<p>i.e., incoming recruitment plus surviving adults.</p>
<p>The next sections of code provide simulated data from two field studies that are assumed to be independent and would provide information on abundance and survival. The first data source is a two-sample (closed) capture-recapture estimate, assumed to be done at the start of each year. The capture probability, used to generate the two binomally-distributed samples, is set at a relatively high default value to obtain better recruitment estimates. The number of recaptures is also binomally distributed, using the observed marked fraction (on average equal to the capture probability). The second data source is a telemetry study that provides annual information on the number of surviving telemetered fish. For example, fixed receivers might be used to detect migratory fish that return annually to a spawning area. We arbitrarily assume that 20 telemetered fish are released each year. For simplicity, transmitters are assumed to last for the duration of the study. Examine the TelTags matrix to see how the annual releases maintain a good sample size.</p>
<p>A hierarchical structure is used to estimate annual recruitment. The overall ln-scale mean and precision are estimated using uninformative priors. Annual recruitment estimates for years 2-Y are drawn from a lognormal distribution using the shared ln-scale mean and precision. (Recruitment in year 1 is used in the simulation but is not estimated because the population projection equation is only used in years 2-Y.) A uniform 0-1 prior is used for annual survival.</p>
<p>Population size in year 1 is Poisson distributed, using the capture-recapture point estimate as the expected value. Population size in subsequent years is also drawn from a Poisson distribution, using the population projection equation as the expected value. Both likelihoods use a binomial distribution (Section <a href="Distributions.html#BinomialDist">3.1.2</a>). The probability for the capture-recapture data is the estimated fraction of the population that is marked. The probability for the telemetry data is the estimated annual survival rate.</p>
<p>Following the JAGS section is some R code to compare the true values with model estimates. The <code>par(xpd=TRUE)</code> turns off clipping so that a legend can be added outside the plot boundary (using inset to set the relative coordinates of the legend). For the third plot, the Chapman modification of the capture-recapture estimator <span class="citation">(<a href="#ref-ricker1975">Ricker 1975</a>)</span> was used to avoid getting a plotting error due to an infinite point estimate in cases with <span class="math inline">\(m_2=0\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="PopModels.html#cb2-1" tabindex="-1"></a><span class="co"># Load necessary library packages</span></span>
<span id="cb2-2"><a href="PopModels.html#cb2-2" tabindex="-1"></a><span class="fu">library</span>(rjags)</span>
<span id="cb2-3"><a href="PopModels.html#cb2-3" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb2-4"><a href="PopModels.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="PopModels.html#cb2-5" tabindex="-1"></a><span class="co"># JAGS code ##################################</span></span>
<span id="cb2-6"><a href="PopModels.html#cb2-6" tabindex="-1"></a><span class="fu">sink</span>(<span class="st">&quot;IPM.txt&quot;</span>)</span>
<span id="cb2-7"><a href="PopModels.html#cb2-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span></span>
<span id="cb2-8"><a href="PopModels.html#cb2-8" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb2-9"><a href="PopModels.html#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="PopModels.html#cb2-10" tabindex="-1"></a><span class="st"># Priors</span></span>
<span id="cb2-11"><a href="PopModels.html#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="PopModels.html#cb2-12" tabindex="-1"></a><span class="st"> Mean_lnR.est ~ dnorm(0, 1E-6)  # Recruitment uses ln-scale parameter</span></span>
<span id="cb2-13"><a href="PopModels.html#cb2-13" tabindex="-1"></a><span class="st"> V_rec.est ~ dunif(0, 10)</span></span>
<span id="cb2-14"><a href="PopModels.html#cb2-14" tabindex="-1"></a><span class="st"> tau &lt;- 1/V_rec.est</span></span>
<span id="cb2-15"><a href="PopModels.html#cb2-15" tabindex="-1"></a><span class="st"> for(y in 1:(Y-1)) {</span></span>
<span id="cb2-16"><a href="PopModels.html#cb2-16" tabindex="-1"></a><span class="st">    N.r.est[y] ~ dlnorm(Mean_lnR.est,tau)</span></span>
<span id="cb2-17"><a href="PopModels.html#cb2-17" tabindex="-1"></a><span class="st">     # Hierarchical structure for recruitment</span></span>
<span id="cb2-18"><a href="PopModels.html#cb2-18" tabindex="-1"></a><span class="st">  } #y</span></span>
<span id="cb2-19"><a href="PopModels.html#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="PopModels.html#cb2-20" tabindex="-1"></a><span class="st">for (y in 1:(Y-1)){</span></span>
<span id="cb2-21"><a href="PopModels.html#cb2-21" tabindex="-1"></a><span class="st">  AnnualS.est[y] ~ dunif(0,1)  # Uninformative prior, adult survival</span></span>
<span id="cb2-22"><a href="PopModels.html#cb2-22" tabindex="-1"></a><span class="st">}#y</span></span>
<span id="cb2-23"><a href="PopModels.html#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="PopModels.html#cb2-24" tabindex="-1"></a><span class="st"># Population projection</span></span>
<span id="cb2-25"><a href="PopModels.html#cb2-25" tabindex="-1"></a><span class="st"> N.a.est[1] ~ dpois((n1[1]+1)*(n2[1]+1)/(m2[1]+1)-1) </span></span>
<span id="cb2-26"><a href="PopModels.html#cb2-26" tabindex="-1"></a><span class="st">  # Year-1 total, Chapman mod in case m2=0</span></span>
<span id="cb2-27"><a href="PopModels.html#cb2-27" tabindex="-1"></a><span class="st">  # Needed to start model because no prior year information</span></span>
<span id="cb2-28"><a href="PopModels.html#cb2-28" tabindex="-1"></a><span class="st"> for(y in 2:Y) {</span></span>
<span id="cb2-29"><a href="PopModels.html#cb2-29" tabindex="-1"></a><span class="st">     N.a.est[y] ~ dpois(N.r.est[y-1] + (AnnualS.est[y-1]*N.a.est[y-1]))</span></span>
<span id="cb2-30"><a href="PopModels.html#cb2-30" tabindex="-1"></a><span class="st">     # Index shifted by one year for recruitment estimates</span></span>
<span id="cb2-31"><a href="PopModels.html#cb2-31" tabindex="-1"></a><span class="st">     } #y</span></span>
<span id="cb2-32"><a href="PopModels.html#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="PopModels.html#cb2-33" tabindex="-1"></a><span class="st">#Likelihoods</span></span>
<span id="cb2-34"><a href="PopModels.html#cb2-34" tabindex="-1"></a><span class="st"># Capture-recapture estimate for total pop size at start of year</span></span>
<span id="cb2-35"><a href="PopModels.html#cb2-35" tabindex="-1"></a><span class="st">  for (y in 2:Y){  # m2[1] used above to get starting pop size</span></span>
<span id="cb2-36"><a href="PopModels.html#cb2-36" tabindex="-1"></a><span class="st">    m2[y] ~ dbin((n1[y]/N.a.est[y]), n2[y])</span></span>
<span id="cb2-37"><a href="PopModels.html#cb2-37" tabindex="-1"></a><span class="st">    } #y</span></span>
<span id="cb2-38"><a href="PopModels.html#cb2-38" tabindex="-1"></a></span>
<span id="cb2-39"><a href="PopModels.html#cb2-39" tabindex="-1"></a><span class="st"># Telemetry information on survival rate</span></span>
<span id="cb2-40"><a href="PopModels.html#cb2-40" tabindex="-1"></a><span class="st">for (y in 1:(Y-1)){</span></span>
<span id="cb2-41"><a href="PopModels.html#cb2-41" tabindex="-1"></a><span class="st">  for (t in ((y+1):Y)){</span></span>
<span id="cb2-42"><a href="PopModels.html#cb2-42" tabindex="-1"></a><span class="st">    TelTags[y,t] ~ dbin(AnnualS.est[t-1],TelTags[y,(t-1)])</span></span>
<span id="cb2-43"><a href="PopModels.html#cb2-43" tabindex="-1"></a><span class="st">  }} # y, t</span></span>
<span id="cb2-44"><a href="PopModels.html#cb2-44" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2-45"><a href="PopModels.html#cb2-45" tabindex="-1"></a><span class="st">    &quot;</span>,<span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-46"><a href="PopModels.html#cb2-46" tabindex="-1"></a><span class="fu">sink</span>()</span>
<span id="cb2-47"><a href="PopModels.html#cb2-47" tabindex="-1"></a></span>
<span id="cb2-48"><a href="PopModels.html#cb2-48" tabindex="-1"></a><span class="co"># Bundle data</span></span>
<span id="cb2-49"><a href="PopModels.html#cb2-49" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;n1&quot;</span>, <span class="st">&quot;n2&quot;</span>, <span class="st">&quot;m2&quot;</span>, <span class="st">&quot;TelTags&quot;</span>)</span>
<span id="cb2-50"><a href="PopModels.html#cb2-50" tabindex="-1"></a></span>
<span id="cb2-51"><a href="PopModels.html#cb2-51" tabindex="-1"></a><span class="co"># Initial values</span></span>
<span id="cb2-52"><a href="PopModels.html#cb2-52" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){ <span class="fu">list</span>(<span class="at">N.r.est=</span> <span class="fu">rlnorm</span>(<span class="at">n=</span>(Y<span class="dv">-1</span>), <span class="at">meanlog=</span><span class="dv">10</span>,</span>
<span id="cb2-53"><a href="PopModels.html#cb2-53" tabindex="-1"></a>                                               <span class="at">sdlog=</span><span class="dv">1</span>),</span>
<span id="cb2-54"><a href="PopModels.html#cb2-54" tabindex="-1"></a>                               <span class="at">AnnualS.est=</span><span class="fu">runif</span>(<span class="at">n=</span>(Y<span class="dv">-1</span>), <span class="at">min=</span><span class="dv">0</span>, </span>
<span id="cb2-55"><a href="PopModels.html#cb2-55" tabindex="-1"></a>                                                 <span class="at">max=</span><span class="dv">1</span>))}</span>
<span id="cb2-56"><a href="PopModels.html#cb2-56" tabindex="-1"></a></span>
<span id="cb2-57"><a href="PopModels.html#cb2-57" tabindex="-1"></a>model.file <span class="ot">&lt;-</span> <span class="st">&#39;IPM.txt&#39;</span></span>
<span id="cb2-58"><a href="PopModels.html#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="PopModels.html#cb2-59" tabindex="-1"></a><span class="co"># Parameters monitored</span></span>
<span id="cb2-60"><a href="PopModels.html#cb2-60" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AnnualS.est&quot;</span>, <span class="st">&quot;N.a.est&quot;</span>, <span class="st">&quot;N.r.est&quot;</span>, <span class="st">&quot;V_rec.est&quot;</span>)</span>
<span id="cb2-61"><a href="PopModels.html#cb2-61" tabindex="-1"></a></span>
<span id="cb2-62"><a href="PopModels.html#cb2-62" tabindex="-1"></a><span class="co"># Call JAGS from R</span></span>
<span id="cb2-63"><a href="PopModels.html#cb2-63" tabindex="-1"></a>jagsfit <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data=</span>jags.data, jags.params, <span class="at">inits=</span>jags.inits,</span>
<span id="cb2-64"><a href="PopModels.html#cb2-64" tabindex="-1"></a>                <span class="at">n.chains =</span> <span class="dv">3</span>, <span class="at">n.thin=</span><span class="dv">1</span>, <span class="at">n.iter =</span> <span class="dv">40000</span>,</span>
<span id="cb2-65"><a href="PopModels.html#cb2-65" tabindex="-1"></a>                model.file)</span>
<span id="cb2-66"><a href="PopModels.html#cb2-66" tabindex="-1"></a><span class="fu">print</span>(jagsfit)</span>
<span id="cb2-67"><a href="PopModels.html#cb2-67" tabindex="-1"></a><span class="fu">plot</span>(jagsfit)</span>
<span id="cb2-68"><a href="PopModels.html#cb2-68" tabindex="-1"></a></span>
<span id="cb2-69"><a href="PopModels.html#cb2-69" tabindex="-1"></a><span class="co"># Code for plots comparing true values and model estimates</span></span>
<span id="cb2-70"><a href="PopModels.html#cb2-70" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb2-71"><a href="PopModels.html#cb2-71" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>(Y<span class="dv">-1</span>)), </span>
<span id="cb2-72"><a href="PopModels.html#cb2-72" tabindex="-1"></a>     jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>AnnualS.est, <span class="at">ylab=</span><span class="st">&quot;Annual Survival&quot;</span>, </span>
<span id="cb2-73"><a href="PopModels.html#cb2-73" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb2-74"><a href="PopModels.html#cb2-74" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">range</span>(AnnualS,jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>AnnualS.est))</span>
<span id="cb2-75"><a href="PopModels.html#cb2-75" tabindex="-1"></a>     <span class="fu">points</span>(AnnualS, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">17</span>)</span>
<span id="cb2-76"><a href="PopModels.html#cb2-76" tabindex="-1"></a>     </span>
<span id="cb2-77"><a href="PopModels.html#cb2-77" tabindex="-1"></a>     <span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>(Y<span class="dv">-1</span>)), </span>
<span id="cb2-78"><a href="PopModels.html#cb2-78" tabindex="-1"></a>          jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.r.est, </span>
<span id="cb2-79"><a href="PopModels.html#cb2-79" tabindex="-1"></a>          <span class="at">ylab=</span><span class="st">&quot;Annual recruitment (years 2-Y)&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb2-80"><a href="PopModels.html#cb2-80" tabindex="-1"></a>          <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb2-81"><a href="PopModels.html#cb2-81" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">range</span>(N.r[<span class="dv">2</span><span class="sc">:</span>Y],jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.r.est))</span>
<span id="cb2-82"><a href="PopModels.html#cb2-82" tabindex="-1"></a>     <span class="fu">points</span>(N.r[<span class="dv">2</span><span class="sc">:</span>Y], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">17</span>)</span>
<span id="cb2-83"><a href="PopModels.html#cb2-83" tabindex="-1"></a>     <span class="fu">par</span>(<span class="at">xpd=</span><span class="cn">TRUE</span>) <span class="co"># Turn off clipping to put legend above plot</span></span>
<span id="cb2-84"><a href="PopModels.html#cb2-84" tabindex="-1"></a>     <span class="fu">legend</span>(<span class="st">&quot;top&quot;</span>,</span>
<span id="cb2-85"><a href="PopModels.html#cb2-85" tabindex="-1"></a>            <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Est&quot;</span>, <span class="st">&quot;True&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb2-86"><a href="PopModels.html#cb2-86" tabindex="-1"></a>            <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>,<span class="dv">17</span>), <span class="at">text.col =</span> <span class="st">&quot;black&quot;</span>,  <span class="at">horiz =</span> T , </span>
<span id="cb2-87"><a href="PopModels.html#cb2-87" tabindex="-1"></a>            <span class="at">inset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.15</span>))</span>
<span id="cb2-88"><a href="PopModels.html#cb2-88" tabindex="-1"></a>     <span class="fu">par</span>(<span class="at">xpd=</span><span class="cn">FALSE</span>)</span>
<span id="cb2-89"><a href="PopModels.html#cb2-89" tabindex="-1"></a>     </span>
<span id="cb2-90"><a href="PopModels.html#cb2-90" tabindex="-1"></a>     MR_N.hat <span class="ot">&lt;-</span> (n1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>(n2<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>(m2<span class="sc">+</span><span class="dv">1</span>) <span class="sc">-</span><span class="dv">1</span> <span class="co"># Chapman mod. in case m2=0</span></span>
<span id="cb2-91"><a href="PopModels.html#cb2-91" tabindex="-1"></a>     <span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>Y), jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.a.est, </span>
<span id="cb2-92"><a href="PopModels.html#cb2-92" tabindex="-1"></a>          <span class="at">ylab=</span><span class="st">&quot;Pop size (includes new recruits)&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Year&quot;</span>,</span>
<span id="cb2-93"><a href="PopModels.html#cb2-93" tabindex="-1"></a>          <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb2-94"><a href="PopModels.html#cb2-94" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">range</span>(N.a,jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.a.est,MR_N.hat))</span>
<span id="cb2-95"><a href="PopModels.html#cb2-95" tabindex="-1"></a>     <span class="fu">points</span>(N.a, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">17</span>) <span class="co"># True adult pop size</span></span>
<span id="cb2-96"><a href="PopModels.html#cb2-96" tabindex="-1"></a>     <span class="fu">points</span>(MR_N.hat, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">0</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>) <span class="co"># Point estimates</span></span></code></pre></div>
<p>Results for the default case show that total population size and annual survival tend to be reliably estimated (Figure <a href="PopModels.html#fig:TwoAgePlot">10.1</a>). Especially at lower capture probabilities, the capture-recapture point estimates (dashed line, open squares) tend to be more variable than the population estimates obtained from the integrated model (solid line). Annual recruitment tends to be less well estimated than total population size or survival rate. There is no direct information about recruitment, so the model makes indirect inferences from total abundance (new age-1 recruits plus 2+ survivors) and telemetry information on survival rate.</p>
<div class="figure"><span style="display:block;" id="fig:TwoAgePlot"></span>
<img src="bookdown_files/figure-html/TwoAgePlot-1.png" alt="Estimates of annual survival (top), recruitment (middle), and total population size (bottom) from a two-age integrated population model fitted to capture-recapture and telemetry data. True values are shown with dotted lines; capture-recapture point estimates (bottom) are shown with a dashed line and open squares." width="90%" /><img src="bookdown_files/figure-html/TwoAgePlot-2.png" alt="Estimates of annual survival (top), recruitment (middle), and total population size (bottom) from a two-age integrated population model fitted to capture-recapture and telemetry data. True values are shown with dotted lines; capture-recapture point estimates (bottom) are shown with a dashed line and open squares." width="90%" /><img src="bookdown_files/figure-html/TwoAgePlot-3.png" alt="Estimates of annual survival (top), recruitment (middle), and total population size (bottom) from a two-age integrated population model fitted to capture-recapture and telemetry data. True values are shown with dotted lines; capture-recapture point estimates (bottom) are shown with a dashed line and open squares." width="90%" />
<p class="caption">
FIGURE 10.1: Estimates of annual survival (top), recruitment (middle), and total population size (bottom) from a two-age integrated population model fitted to capture-recapture and telemetry data. True values are shown with dotted lines; capture-recapture point estimates (bottom) are shown with a dashed line and open squares.
</p>
</div>
<p>After doing multiple runs with the default settings, try varying the capture probability for the capture-recapture study and the annual release of fish with transmitters. As expected, a higher capture probability improves the estimates of total population size, and more transmitters improve the annual survival estimates.</p>
</div>
<div id="CAGEAN" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Full age-structured model<a href="PopModels.html#CAGEAN" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another type of IPM is a fish stock assessment that typically uses catch by age and year to estimate population size and fishing mortality rate <span class="citation">(<a href="#ref-millar.meyer2000">Millar and Meyer 2000</a>; <a href="#ref-schaub.etal_2024">Schaub et al. 2024</a>)</span>. Fish stock assessment models share many characteristics with IPMs developed for terrestrial species, but typically have a much greater spatial scale and are more focused on harvest regulation <span class="citation">(<a href="#ref-schaub.etal_2024">Schaub et al. 2024</a>)</span>. These models serve as the foundation for much of marine fishery management, as well as in freshwater fisheries where sufficient data are available <span class="citation">(e.g., <a href="#ref-fielder.bence_2014">Fielder and Bence 2014</a>)</span>. Catch data are a valuable source of information because they reflect absolute abundance. Summing the catches from a cohort (year class) across years (along a diagonal in the catch-at-age matrix) provides a conservative estimate of the initial abundance of that cohort. Early versions of catch-at-age analysis (VPA; cohort analysis) were simple upward adjustments of the summed catches in order to account for natural mortality <span class="citation">(<a href="#ref-ricker1975">Ricker 1975</a>)</span>. Current catch-at-age analyses have a statistical foundation using either maximum-likelihood or Bayesian estimation <span class="citation">(<a href="#ref-maunder.punt_2013">Maunder and Punt 2013</a>)</span>. Catch data alone are insufficient to obtain reliable results, so current assessments integrate fishery catch data with axuiliary information from the fishery (e.g., annual level of fishing effort) or surveys <span class="citation">(<a href="#ref-deriso.etal_1985">Deriso, Quinn II, and Neal 1985</a>; <a href="#ref-maunder.punt_2013">Maunder and Punt 2013</a>; <a href="#ref-schaub.etal_2024">Schaub et al. 2024</a>)</span>. Our example will use JAGS to fit a relatively simple age-structured stock assessment model, but we note that most current assessments are done using flexible and powerful software such as AD Model Builder or Stock Synthesis <span class="citation">(<a href="#ref-fournier.etal_2012">Fournier et al. 2012</a>; <a href="#ref-methot.wetzell_2013">Methot and Wetzell 2013</a>)</span>.</p>
<p>We assume a single fishery with gear selectivity that is constant over time. Our auxiliary data are survey catches by age and year, with a survey selectivity pattern that is also constant over time. The default selectivity pattern for the survey provides information mostly on younger ages whereas the fishery primarily exploits older fish. Thus a combined analysis is able to make better inferences than either data set alone. Essentially the goal of the analysis is to find the population estimates that are most consistent with the observed catches and auxiliary data.</p>
<p>The simulation code builds on that used in the cohort-specific catch-curve analysis (<a href="Survival.html#Cohort">6.1.2</a>) and recruitment (<a href="Recruit.html#Recruit">9</a>) sections. The number of ages is arbitrary but should be sufficient to characterize the selectivity patterns for the fishery and survey. Annual instantaneous fishing mortality rate varies randomly between user-set bounds. The instantaneous natural mortality rate can be difficult to estimate internally <span class="citation">(<a href="#ref-quinn.deriso_1999">Quinn and Deriso 1999</a>; <a href="#ref-schaub.etal_2024">Schaub et al. 2024</a>)</span>, so here it is fixed in the simulation and the fitted model <span class="citation">(e.g., using external information such as longevity: <a href="#ref-lorenzen1996">Lorenzen 1996</a>; <a href="#ref-then.etal_2015">Then et al. 2015</a>)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="PopModels.html#cb3-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co"># Clear Environment</span></span>
<span id="cb3-2"><a href="PopModels.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="PopModels.html#cb3-3" tabindex="-1"></a><span class="co"># Simulation to create survey and fishery catch-at-age matrices</span></span>
<span id="cb3-4"><a href="PopModels.html#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="PopModels.html#cb3-5" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="co"># Arbitrary number of ages and years (but enough to fit model)</span></span>
<span id="cb3-6"><a href="PopModels.html#cb3-6" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb3-7"><a href="PopModels.html#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="PopModels.html#cb3-8" tabindex="-1"></a>LowF <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Arbitrary lower bound</span></span>
<span id="cb3-9"><a href="PopModels.html#cb3-9" tabindex="-1"></a>HighF <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># Arbitrary upper bound</span></span>
<span id="cb3-10"><a href="PopModels.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="PopModels.html#cb3-11" tabindex="-1"></a>AnnualF <span class="ot">&lt;-</span> <span class="fu">runif</span>(Y, <span class="at">min=</span>LowF, <span class="at">max=</span>HighF)</span>
<span id="cb3-12"><a href="PopModels.html#cb3-12" tabindex="-1"></a>AnnualM <span class="ot">&lt;-</span> <span class="fl">0.2</span> <span class="co"># Fixed</span></span>
<span id="cb3-13"><a href="PopModels.html#cb3-13" tabindex="-1"></a></span>
<span id="cb3-14"><a href="PopModels.html#cb3-14" tabindex="-1"></a><span class="co"># F by age, using separable model</span></span>
<span id="cb3-15"><a href="PopModels.html#cb3-15" tabindex="-1"></a>Fishery_k <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># Slope for logistic function</span></span>
<span id="cb3-16"><a href="PopModels.html#cb3-16" tabindex="-1"></a>Fishery_a_50 <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># Age at 0.5 selectivity</span></span>
<span id="cb3-17"><a href="PopModels.html#cb3-17" tabindex="-1"></a>SelF <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span>A) <span class="co"># Fishery selectivity pattern</span></span>
<span id="cb3-18"><a href="PopModels.html#cb3-18" tabindex="-1"></a>F_a <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Matrix for F by age and year</span></span>
<span id="cb3-19"><a href="PopModels.html#cb3-19" tabindex="-1"></a>Z_a <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Matrix for Z by age and year</span></span>
<span id="cb3-20"><a href="PopModels.html#cb3-20" tabindex="-1"></a>Exp_C_f <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Fishery catch-at-age matrix</span></span>
<span id="cb3-21"><a href="PopModels.html#cb3-21" tabindex="-1"></a>C_f <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Obs fishery catch-at-age matrix</span></span>
<span id="cb3-22"><a href="PopModels.html#cb3-22" tabindex="-1"></a>Exp_C_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Survey catch-at-age matrix</span></span>
<span id="cb3-23"><a href="PopModels.html#cb3-23" tabindex="-1"></a>C_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,Y)) <span class="co"># Obs survey catch-at-age matrix</span></span>
<span id="cb3-24"><a href="PopModels.html#cb3-24" tabindex="-1"></a>S_a <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A,(Y<span class="dv">-1</span>))) <span class="co"># Matrix for survival rate</span></span>
<span id="cb3-25"><a href="PopModels.html#cb3-25" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>A){</span>
<span id="cb3-26"><a href="PopModels.html#cb3-26" tabindex="-1"></a>  SelF[a] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>Fishery_k<span class="sc">*</span>(a<span class="sc">-</span>Fishery_a_50)))</span>
<span id="cb3-27"><a href="PopModels.html#cb3-27" tabindex="-1"></a>} <span class="co">#a</span></span>
<span id="cb3-28"><a href="PopModels.html#cb3-28" tabindex="-1"></a><span class="co">#plot(SelF)</span></span>
<span id="cb3-29"><a href="PopModels.html#cb3-29" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(Y)) {</span>
<span id="cb3-30"><a href="PopModels.html#cb3-30" tabindex="-1"></a>  <span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>A){</span>
<span id="cb3-31"><a href="PopModels.html#cb3-31" tabindex="-1"></a>    F_a[a,y] <span class="ot">&lt;-</span> AnnualF[y] <span class="sc">*</span> SelF[a]</span>
<span id="cb3-32"><a href="PopModels.html#cb3-32" tabindex="-1"></a>  } <span class="co">#a</span></span>
<span id="cb3-33"><a href="PopModels.html#cb3-33" tabindex="-1"></a>} <span class="co">#y</span></span>
<span id="cb3-34"><a href="PopModels.html#cb3-34" tabindex="-1"></a>Z_a <span class="ot">&lt;-</span> F_a <span class="sc">+</span> AnnualM</span>
<span id="cb3-35"><a href="PopModels.html#cb3-35" tabindex="-1"></a>S_a <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>Z_a)</span>
<span id="cb3-36"><a href="PopModels.html#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="PopModels.html#cb3-37" tabindex="-1"></a>MeanR <span class="ot">&lt;-</span> <span class="fl">1E5</span> <span class="co"># Arbitrary mean initial cohort size</span></span>
<span id="cb3-38"><a href="PopModels.html#cb3-38" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(A, Y))</span>
<span id="cb3-39"><a href="PopModels.html#cb3-39" tabindex="-1"></a>V_rec <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Log-scale recruitment variance</span></span>
<span id="cb3-40"><a href="PopModels.html#cb3-40" tabindex="-1"></a>SD_rec <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(V_rec)</span>
<span id="cb3-41"><a href="PopModels.html#cb3-41" tabindex="-1"></a>N[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">trunc</span>(MeanR <span class="sc">*</span> <span class="fu">rlnorm</span>(<span class="at">n=</span>Y, <span class="dv">0</span>, SD_rec)) </span>
<span id="cb3-42"><a href="PopModels.html#cb3-42" tabindex="-1"></a><span class="co"># Starting size of each cohort at first age</span></span>
<span id="cb3-43"><a href="PopModels.html#cb3-43" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>A){</span>
<span id="cb3-44"><a href="PopModels.html#cb3-44" tabindex="-1"></a>  N[a,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">trunc</span>(<span class="fu">prod</span>(S_a[<span class="dv">1</span><span class="sc">:</span>(a<span class="dv">-1</span>),<span class="dv">1</span>])<span class="sc">*</span>MeanR <span class="sc">*</span> <span class="fu">rlnorm</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>, SD_rec))</span>
<span id="cb3-45"><a href="PopModels.html#cb3-45" tabindex="-1"></a>  <span class="co"># Use year-1 S_a to generate year-1 N</span></span>
<span id="cb3-46"><a href="PopModels.html#cb3-46" tabindex="-1"></a>  <span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>Y){</span>
<span id="cb3-47"><a href="PopModels.html#cb3-47" tabindex="-1"></a>    N[a,y] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, N[(a<span class="dv">-1</span>), (y<span class="dv">-1</span>)], S_a[(a<span class="dv">-1</span>),(y<span class="dv">-1</span>)])</span>
<span id="cb3-48"><a href="PopModels.html#cb3-48" tabindex="-1"></a>  } <span class="co">#y</span></span>
<span id="cb3-49"><a href="PopModels.html#cb3-49" tabindex="-1"></a>} <span class="co">#a</span></span>
<span id="cb3-50"><a href="PopModels.html#cb3-50" tabindex="-1"></a></span>
<span id="cb3-51"><a href="PopModels.html#cb3-51" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(Y<span class="dv">-1</span>)){ <span class="co"># Deaths due to fishing (binomial random variate)</span></span>
<span id="cb3-52"><a href="PopModels.html#cb3-52" tabindex="-1"></a>  <span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(A<span class="dv">-1</span>)){</span>
<span id="cb3-53"><a href="PopModels.html#cb3-53" tabindex="-1"></a>    Exp_C_f[a,y] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, N[a,y]<span class="sc">-</span>N[(a<span class="sc">+</span><span class="dv">1</span>),(y<span class="sc">+</span><span class="dv">1</span>)],(F_a[a,y]<span class="sc">/</span>Z_a[a,y]))</span>
<span id="cb3-54"><a href="PopModels.html#cb3-54" tabindex="-1"></a>  } <span class="co">#y</span></span>
<span id="cb3-55"><a href="PopModels.html#cb3-55" tabindex="-1"></a>} <span class="co">#a</span></span>
<span id="cb3-56"><a href="PopModels.html#cb3-56" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(Y<span class="dv">-1</span>)){ <span class="co"># Random catch last age</span></span>
<span id="cb3-57"><a href="PopModels.html#cb3-57" tabindex="-1"></a>  Exp_C_f[A,y] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,N[A,y],F_a[A,y]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Z_a[A,y]))<span class="sc">/</span>Z_a[A,y])</span>
<span id="cb3-58"><a href="PopModels.html#cb3-58" tabindex="-1"></a>} <span class="co">#y</span></span>
<span id="cb3-59"><a href="PopModels.html#cb3-59" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>A){ <span class="co"># Random catch last year</span></span>
<span id="cb3-60"><a href="PopModels.html#cb3-60" tabindex="-1"></a>  Exp_C_f[a,Y] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,N[a,Y],F_a[a,Y]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Z_a[a,Y]))<span class="sc">/</span>Z_a[a,Y])</span>
<span id="cb3-61"><a href="PopModels.html#cb3-61" tabindex="-1"></a>} <span class="co">#y</span></span>
<span id="cb3-62"><a href="PopModels.html#cb3-62" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Y){</span>
<span id="cb3-63"><a href="PopModels.html#cb3-63" tabindex="-1"></a>  C_f[,y] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(<span class="fu">rmultinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="fu">sum</span>(Exp_C_f[,y]), </span>
<span id="cb3-64"><a href="PopModels.html#cb3-64" tabindex="-1"></a>                                   <span class="at">prob=</span>Exp_C_f[,y])))</span>
<span id="cb3-65"><a href="PopModels.html#cb3-65" tabindex="-1"></a>} <span class="co">#y</span></span>
<span id="cb3-66"><a href="PopModels.html#cb3-66" tabindex="-1"></a></span>
<span id="cb3-67"><a href="PopModels.html#cb3-67" tabindex="-1"></a><span class="co"># Generate survey catch-at-age matrix</span></span>
<span id="cb3-68"><a href="PopModels.html#cb3-68" tabindex="-1"></a>Survey_q <span class="ot">&lt;-</span> <span class="fl">1E-3</span> <span class="co"># Catchability coefficient (Adjust relative to MeanR)</span></span>
<span id="cb3-69"><a href="PopModels.html#cb3-69" tabindex="-1"></a>Survey_k <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="co"># Slope for logistic function</span></span>
<span id="cb3-70"><a href="PopModels.html#cb3-70" tabindex="-1"></a>Survey_a_50 <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># Age at 0.5 selectivity</span></span>
<span id="cb3-71"><a href="PopModels.html#cb3-71" tabindex="-1"></a>SelS <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span>A) <span class="co"># Survey selectivity pattern</span></span>
<span id="cb3-72"><a href="PopModels.html#cb3-72" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>A){</span>
<span id="cb3-73"><a href="PopModels.html#cb3-73" tabindex="-1"></a>  SelS[a] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>Survey_k<span class="sc">*</span>(a<span class="sc">-</span>Survey_a_50)))</span>
<span id="cb3-74"><a href="PopModels.html#cb3-74" tabindex="-1"></a>} <span class="co">#a</span></span>
<span id="cb3-75"><a href="PopModels.html#cb3-75" tabindex="-1"></a><span class="co">#plot(SelS)</span></span>
<span id="cb3-76"><a href="PopModels.html#cb3-76" tabindex="-1"></a></span>
<span id="cb3-77"><a href="PopModels.html#cb3-77" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Y) {</span>
<span id="cb3-78"><a href="PopModels.html#cb3-78" tabindex="-1"></a>  <span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>A){</span>
<span id="cb3-79"><a href="PopModels.html#cb3-79" tabindex="-1"></a>    Exp_C_s[a,y] <span class="ot">&lt;-</span> Survey_q<span class="sc">*</span>SelS[a]<span class="sc">*</span>N[a,y]</span>
<span id="cb3-80"><a href="PopModels.html#cb3-80" tabindex="-1"></a>  } <span class="co">#a</span></span>
<span id="cb3-81"><a href="PopModels.html#cb3-81" tabindex="-1"></a>} <span class="co">#y </span></span>
<span id="cb3-82"><a href="PopModels.html#cb3-82" tabindex="-1"></a></span>
<span id="cb3-83"><a href="PopModels.html#cb3-83" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Y){</span>
<span id="cb3-84"><a href="PopModels.html#cb3-84" tabindex="-1"></a>  C_s[,y] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(<span class="fu">rmultinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="fu">sum</span>(Exp_C_s[,y]), </span>
<span id="cb3-85"><a href="PopModels.html#cb3-85" tabindex="-1"></a>                                   <span class="at">prob=</span>Exp_C_s[,y])))</span>
<span id="cb3-86"><a href="PopModels.html#cb3-86" tabindex="-1"></a>  } <span class="co">#y</span></span></code></pre></div>
<p>Survival across ages and years varies randomly according to a binomial distribution (Section <a href="Distributions.html#BinomialDist">3.1.2</a>). Age- and year-specific catch also varies randomly according to a binomial distribution, based on the fraction of deaths due to fishing (F/Z). Sampling variation in the fishery and survey catch matrices is based on a multinomial distribution (Section <a href="Distributions.html#Multinomial">3.1.3</a>). Compare the fishery and survey catch matrices to see the effects of gear selectivity. Also examine the population matrix to see strong and weak year classes moving through the population.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="PopModels.html#cb4-1" tabindex="-1"></a><span class="co"># Load necessary library packages</span></span>
<span id="cb4-2"><a href="PopModels.html#cb4-2" tabindex="-1"></a><span class="fu">library</span>(rjags)</span>
<span id="cb4-3"><a href="PopModels.html#cb4-3" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb4-4"><a href="PopModels.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="PopModels.html#cb4-5" tabindex="-1"></a><span class="co"># JAGS code ##################################</span></span>
<span id="cb4-6"><a href="PopModels.html#cb4-6" tabindex="-1"></a><span class="fu">sink</span>(<span class="st">&quot;CatchAge.txt&quot;</span>)</span>
<span id="cb4-7"><a href="PopModels.html#cb4-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span></span>
<span id="cb4-8"><a href="PopModels.html#cb4-8" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb4-9"><a href="PopModels.html#cb4-9" tabindex="-1"></a><span class="st"># Model parameters: AnnualF[1:Y], k and a_50 for fishery and survey, </span></span>
<span id="cb4-10"><a href="PopModels.html#cb4-10" tabindex="-1"></a><span class="st"># survey q, Mean recruitment, SD, and annual deviations years 1:Y,</span></span>
<span id="cb4-11"><a href="PopModels.html#cb4-11" tabindex="-1"></a><span class="st"># initial numbers ages 2:A for year 1</span></span>
<span id="cb4-12"><a href="PopModels.html#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="PopModels.html#cb4-13" tabindex="-1"></a><span class="st"> Mean_lnR.est ~ dnorm(0, 1E-6)</span></span>
<span id="cb4-14"><a href="PopModels.html#cb4-14" tabindex="-1"></a><span class="st">   # Recruitment uses ln-scale parameter</span></span>
<span id="cb4-15"><a href="PopModels.html#cb4-15" tabindex="-1"></a><span class="st"> MeanR.est &lt;- exp(Mean_lnR.est)</span></span>
<span id="cb4-16"><a href="PopModels.html#cb4-16" tabindex="-1"></a><span class="st"> V_rec.est ~ dunif(0, 10)</span></span>
<span id="cb4-17"><a href="PopModels.html#cb4-17" tabindex="-1"></a><span class="st"> tau &lt;- 1/V_rec.est</span></span>
<span id="cb4-18"><a href="PopModels.html#cb4-18" tabindex="-1"></a><span class="st"> for(y in 1:Y) {</span></span>
<span id="cb4-19"><a href="PopModels.html#cb4-19" tabindex="-1"></a><span class="st">    Recruit.est[y] ~ dlnorm(Mean_lnR.est,tau)</span></span>
<span id="cb4-20"><a href="PopModels.html#cb4-20" tabindex="-1"></a><span class="st">     # Hierarchical structure for recruitment</span></span>
<span id="cb4-21"><a href="PopModels.html#cb4-21" tabindex="-1"></a><span class="st">    N.est[1,y]&lt;-Recruit.est[y] }</span></span>
<span id="cb4-22"><a href="PopModels.html#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="PopModels.html#cb4-23" tabindex="-1"></a><span class="st">    for(a in 2:A){</span></span>
<span id="cb4-24"><a href="PopModels.html#cb4-24" tabindex="-1"></a><span class="st">      Initial.est[a-1] ~ dlnorm(0, 1E-6)</span></span>
<span id="cb4-25"><a href="PopModels.html#cb4-25" tabindex="-1"></a><span class="st">        # Offset index to run Initials vector from 1 to A-1</span></span>
<span id="cb4-26"><a href="PopModels.html#cb4-26" tabindex="-1"></a><span class="st">    N.est[a,1]&lt;-Initial.est[a-1] }</span></span>
<span id="cb4-27"><a href="PopModels.html#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="PopModels.html#cb4-28" tabindex="-1"></a><span class="st">Fishery_k.est ~ dnorm(0, 1E-3)</span></span>
<span id="cb4-29"><a href="PopModels.html#cb4-29" tabindex="-1"></a><span class="st">  # Allow for positive or negative slope for logistic function</span></span>
<span id="cb4-30"><a href="PopModels.html#cb4-30" tabindex="-1"></a><span class="st">Fishery_a_50.est ~ dunif(0,A)</span></span>
<span id="cb4-31"><a href="PopModels.html#cb4-31" tabindex="-1"></a><span class="st">for (a in 1:A){</span></span>
<span id="cb4-32"><a href="PopModels.html#cb4-32" tabindex="-1"></a><span class="st">  SelF.est[a] &lt;- 1/(1+exp(-Fishery_k.est*(a-Fishery_a_50.est)))</span></span>
<span id="cb4-33"><a href="PopModels.html#cb4-33" tabindex="-1"></a><span class="st">  }#a</span></span>
<span id="cb4-34"><a href="PopModels.html#cb4-34" tabindex="-1"></a></span>
<span id="cb4-35"><a href="PopModels.html#cb4-35" tabindex="-1"></a><span class="st">for (y in 1:Y){</span></span>
<span id="cb4-36"><a href="PopModels.html#cb4-36" tabindex="-1"></a><span class="st">  AnnualF.est[y] ~ dunif(0,2) # Arbitrary range</span></span>
<span id="cb4-37"><a href="PopModels.html#cb4-37" tabindex="-1"></a><span class="st">  for (a in 1:A){</span></span>
<span id="cb4-38"><a href="PopModels.html#cb4-38" tabindex="-1"></a><span class="st">    F_a.est[a,y] &lt;- AnnualF.est[y] * SelF.est[a]</span></span>
<span id="cb4-39"><a href="PopModels.html#cb4-39" tabindex="-1"></a><span class="st">      # Separable model (F[a,y]=Sel[a]*F[y])</span></span>
<span id="cb4-40"><a href="PopModels.html#cb4-40" tabindex="-1"></a><span class="st">    Z_a.est[a,y] &lt;- F_a.est[a,y] + AnnualM</span></span>
<span id="cb4-41"><a href="PopModels.html#cb4-41" tabindex="-1"></a><span class="st">      # Assume that M is known (fixed externally)</span></span>
<span id="cb4-42"><a href="PopModels.html#cb4-42" tabindex="-1"></a><span class="st">  }#a</span></span>
<span id="cb4-43"><a href="PopModels.html#cb4-43" tabindex="-1"></a><span class="st">}#y</span></span>
<span id="cb4-44"><a href="PopModels.html#cb4-44" tabindex="-1"></a></span>
<span id="cb4-45"><a href="PopModels.html#cb4-45" tabindex="-1"></a><span class="st">Survey_q.est ~ dgamma(1,1) # Uninformative nonnegative prior</span></span>
<span id="cb4-46"><a href="PopModels.html#cb4-46" tabindex="-1"></a><span class="st">Survey_k.est ~ dnorm(0, 1E-3)</span></span>
<span id="cb4-47"><a href="PopModels.html#cb4-47" tabindex="-1"></a><span class="st">  # Allow for positive or negative slope for logistic function</span></span>
<span id="cb4-48"><a href="PopModels.html#cb4-48" tabindex="-1"></a><span class="st">Survey_a_50.est ~ dunif(0, A)</span></span>
<span id="cb4-49"><a href="PopModels.html#cb4-49" tabindex="-1"></a><span class="st">for (a in 1:A){</span></span>
<span id="cb4-50"><a href="PopModels.html#cb4-50" tabindex="-1"></a><span class="st">  SelS.est[a] &lt;- 1/(1+exp(-Survey_k.est*(a-Survey_a_50.est)))</span></span>
<span id="cb4-51"><a href="PopModels.html#cb4-51" tabindex="-1"></a><span class="st">  } #a</span></span>
<span id="cb4-52"><a href="PopModels.html#cb4-52" tabindex="-1"></a></span>
<span id="cb4-53"><a href="PopModels.html#cb4-53" tabindex="-1"></a><span class="st">    # Population projection</span></span>
<span id="cb4-54"><a href="PopModels.html#cb4-54" tabindex="-1"></a><span class="st">    for(a in 2:A) {</span></span>
<span id="cb4-55"><a href="PopModels.html#cb4-55" tabindex="-1"></a><span class="st">   for(y in 2:Y) {</span></span>
<span id="cb4-56"><a href="PopModels.html#cb4-56" tabindex="-1"></a><span class="st">     N.est[a,y] ~ dbin(exp(-AnnualM-F_a.est[(a-1),(y-1)]),</span></span>
<span id="cb4-57"><a href="PopModels.html#cb4-57" tabindex="-1"></a><span class="st">                         trunc(N.est[a-1,y-1])) } }</span></span>
<span id="cb4-58"><a href="PopModels.html#cb4-58" tabindex="-1"></a></span>
<span id="cb4-59"><a href="PopModels.html#cb4-59" tabindex="-1"></a><span class="st">    #Likelihoods</span></span>
<span id="cb4-60"><a href="PopModels.html#cb4-60" tabindex="-1"></a><span class="st">    for (a in 1:A) {</span></span>
<span id="cb4-61"><a href="PopModels.html#cb4-61" tabindex="-1"></a><span class="st">   for (y in 1:Y) {</span></span>
<span id="cb4-62"><a href="PopModels.html#cb4-62" tabindex="-1"></a><span class="st">     C_f.est[a,y] &lt;- N.est[a,y]*F_a.est[a,y]*(1-exp(-Z_a.est[a,y]))</span></span>
<span id="cb4-63"><a href="PopModels.html#cb4-63" tabindex="-1"></a><span class="st">                      /Z_a.est[a,y]</span></span>
<span id="cb4-64"><a href="PopModels.html#cb4-64" tabindex="-1"></a><span class="st">     C_f[a,y] ~ dpois(C_f.est[a,y])</span></span>
<span id="cb4-65"><a href="PopModels.html#cb4-65" tabindex="-1"></a><span class="st">     C_s.est[a,y] &lt;- N.est[a,y]*Survey_q.est*SelS.est[a]</span></span>
<span id="cb4-66"><a href="PopModels.html#cb4-66" tabindex="-1"></a><span class="st">     C_s[a,y] ~ dpois(C_s.est[a,y])</span></span>
<span id="cb4-67"><a href="PopModels.html#cb4-67" tabindex="-1"></a><span class="st">   } } # y, a</span></span>
<span id="cb4-68"><a href="PopModels.html#cb4-68" tabindex="-1"></a><span class="st">   for (y in 1:Y){</span></span>
<span id="cb4-69"><a href="PopModels.html#cb4-69" tabindex="-1"></a><span class="st">    N.est.total[y] &lt;- sum(N.est[,y])</span></span>
<span id="cb4-70"><a href="PopModels.html#cb4-70" tabindex="-1"></a><span class="st">   }</span></span>
<span id="cb4-71"><a href="PopModels.html#cb4-71" tabindex="-1"></a></span>
<span id="cb4-72"><a href="PopModels.html#cb4-72" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb4-73"><a href="PopModels.html#cb4-73" tabindex="-1"></a><span class="st">    &quot;</span>,<span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-74"><a href="PopModels.html#cb4-74" tabindex="-1"></a><span class="fu">sink</span>()</span>
<span id="cb4-75"><a href="PopModels.html#cb4-75" tabindex="-1"></a></span>
<span id="cb4-76"><a href="PopModels.html#cb4-76" tabindex="-1"></a><span class="co"># Bundle data</span></span>
<span id="cb4-77"><a href="PopModels.html#cb4-77" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C_f&quot;</span>, <span class="st">&quot;C_s&quot;</span>, <span class="st">&quot;AnnualM&quot;</span>)</span>
<span id="cb4-78"><a href="PopModels.html#cb4-78" tabindex="-1"></a></span>
<span id="cb4-79"><a href="PopModels.html#cb4-79" tabindex="-1"></a><span class="co"># Initial values</span></span>
<span id="cb4-80"><a href="PopModels.html#cb4-80" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){ <span class="fu">list</span>(<span class="at">Mean_lnR.est=</span><span class="fu">rlnorm</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">meanlog=</span><span class="dv">10</span>, </span>
<span id="cb4-81"><a href="PopModels.html#cb4-81" tabindex="-1"></a>                                                   <span class="at">sdlog=</span><span class="dv">1</span>),</span>
<span id="cb4-82"><a href="PopModels.html#cb4-82" tabindex="-1"></a>                               <span class="at">Recruit.est=</span><span class="fu">rlnorm</span>(<span class="at">n=</span>Y, <span class="at">meanlog=</span><span class="dv">10</span>, </span>
<span id="cb4-83"><a href="PopModels.html#cb4-83" tabindex="-1"></a>                                                  <span class="at">sdlog=</span><span class="dv">1</span>),</span>
<span id="cb4-84"><a href="PopModels.html#cb4-84" tabindex="-1"></a>                               <span class="at">Initial.est=</span><span class="fu">rlnorm</span>(<span class="at">n=</span>(A<span class="dv">-1</span>), <span class="at">meanlog=</span><span class="dv">10</span>, </span>
<span id="cb4-85"><a href="PopModels.html#cb4-85" tabindex="-1"></a>                                                  <span class="at">sdlog=</span><span class="dv">1</span>),</span>
<span id="cb4-86"><a href="PopModels.html#cb4-86" tabindex="-1"></a>                               <span class="at">Survey_q.est=</span><span class="fu">rgamma</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">shape=</span><span class="dv">1</span>, </span>
<span id="cb4-87"><a href="PopModels.html#cb4-87" tabindex="-1"></a>                                                   <span class="at">scale=</span><span class="dv">1</span>),</span>
<span id="cb4-88"><a href="PopModels.html#cb4-88" tabindex="-1"></a>                               <span class="at">V_rec.est=</span><span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">10</span>),</span>
<span id="cb4-89"><a href="PopModels.html#cb4-89" tabindex="-1"></a>                               <span class="at">AnnualF.est=</span><span class="fu">runif</span>(<span class="at">n=</span>Y, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">2</span>))}</span>
<span id="cb4-90"><a href="PopModels.html#cb4-90" tabindex="-1"></a></span>
<span id="cb4-91"><a href="PopModels.html#cb4-91" tabindex="-1"></a>model.file <span class="ot">&lt;-</span> <span class="st">&#39;CatchAge.txt&#39;</span></span>
<span id="cb4-92"><a href="PopModels.html#cb4-92" tabindex="-1"></a></span>
<span id="cb4-93"><a href="PopModels.html#cb4-93" tabindex="-1"></a><span class="co"># Parameters monitored</span></span>
<span id="cb4-94"><a href="PopModels.html#cb4-94" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AnnualF.est&quot;</span>, <span class="st">&quot;Recruit.est&quot;</span>, <span class="st">&quot;Initial.est&quot;</span>,</span>
<span id="cb4-95"><a href="PopModels.html#cb4-95" tabindex="-1"></a>                 <span class="st">&quot;SelF.est&quot;</span>, <span class="st">&quot;Survey_q.est&quot;</span>, <span class="st">&quot;MeanR.est&quot;</span>,</span>
<span id="cb4-96"><a href="PopModels.html#cb4-96" tabindex="-1"></a>                 <span class="st">&quot;V_rec.est&quot;</span>, <span class="st">&quot;SelS.est&quot;</span>, <span class="st">&quot;N.est.total&quot;</span>)</span>
<span id="cb4-97"><a href="PopModels.html#cb4-97" tabindex="-1"></a></span>
<span id="cb4-98"><a href="PopModels.html#cb4-98" tabindex="-1"></a><span class="co"># Call JAGS from R</span></span>
<span id="cb4-99"><a href="PopModels.html#cb4-99" tabindex="-1"></a>jagsfit <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data=</span>jags.data, jags.params, <span class="at">inits=</span>jags.inits,</span>
<span id="cb4-100"><a href="PopModels.html#cb4-100" tabindex="-1"></a>                <span class="at">n.chains =</span> <span class="dv">3</span>, <span class="at">n.thin=</span><span class="dv">10</span>, <span class="at">n.iter =</span> <span class="dv">200000</span>,</span>
<span id="cb4-101"><a href="PopModels.html#cb4-101" tabindex="-1"></a>                model.file)</span>
<span id="cb4-102"><a href="PopModels.html#cb4-102" tabindex="-1"></a><span class="fu">print</span>(jagsfit)</span>
<span id="cb4-103"><a href="PopModels.html#cb4-103" tabindex="-1"></a><span class="fu">plot</span>(jagsfit)</span>
<span id="cb4-104"><a href="PopModels.html#cb4-104" tabindex="-1"></a></span>
<span id="cb4-105"><a href="PopModels.html#cb4-105" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb4-106"><a href="PopModels.html#cb4-106" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>Y), jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>AnnualF.est, <span class="at">ylab=</span><span class="st">&quot;Annual F&quot;</span>, </span>
<span id="cb4-107"><a href="PopModels.html#cb4-107" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb4-108"><a href="PopModels.html#cb4-108" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">range</span>(AnnualF,jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>AnnualF.est))</span>
<span id="cb4-109"><a href="PopModels.html#cb4-109" tabindex="-1"></a><span class="fu">points</span>(AnnualF, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>)</span>
<span id="cb4-110"><a href="PopModels.html#cb4-110" tabindex="-1"></a></span>
<span id="cb4-111"><a href="PopModels.html#cb4-111" tabindex="-1"></a>N.total <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">dim=</span>Y)</span>
<span id="cb4-112"><a href="PopModels.html#cb4-112" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Y){</span>
<span id="cb4-113"><a href="PopModels.html#cb4-113" tabindex="-1"></a>  N.total[y] <span class="ot">&lt;-</span> <span class="fu">sum</span>(N[,y])</span>
<span id="cb4-114"><a href="PopModels.html#cb4-114" tabindex="-1"></a>}</span>
<span id="cb4-115"><a href="PopModels.html#cb4-115" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>Y), jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.est.total, <span class="at">ylab=</span><span class="st">&quot;Total N&quot;</span>, </span>
<span id="cb4-116"><a href="PopModels.html#cb4-116" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Year&quot;</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb4-117"><a href="PopModels.html#cb4-117" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">range</span>(N.total,jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>N.est.total))</span>
<span id="cb4-118"><a href="PopModels.html#cb4-118" tabindex="-1"></a></span>
<span id="cb4-119"><a href="PopModels.html#cb4-119" tabindex="-1"></a><span class="fu">points</span>(N.total[], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>)</span>
<span id="cb4-120"><a href="PopModels.html#cb4-120" tabindex="-1"></a></span>
<span id="cb4-121"><a href="PopModels.html#cb4-121" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>A), jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>SelF.est, </span>
<span id="cb4-122"><a href="PopModels.html#cb4-122" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Fishery selectivity&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Age&quot;</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb4-123"><a href="PopModels.html#cb4-123" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb4-124"><a href="PopModels.html#cb4-124" tabindex="-1"></a><span class="fu">points</span>(SelF, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>)</span>
<span id="cb4-125"><a href="PopModels.html#cb4-125" tabindex="-1"></a></span>
<span id="cb4-126"><a href="PopModels.html#cb4-126" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>A), jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>mean<span class="sc">$</span>SelS.est,</span>
<span id="cb4-127"><a href="PopModels.html#cb4-127" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Survey selectivity&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Age&quot;</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, </span>
<span id="cb4-128"><a href="PopModels.html#cb4-128" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb4-129"><a href="PopModels.html#cb4-129" tabindex="-1"></a><span class="fu">points</span>(SelS, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p>Convergence (Rhat &lt; 1.1) for this model requires a very large number of updates (and considerable time). Thinning is used to reduce the storage required. The plots following the JAGS code show that there is typically close agreement between the true and estimated values (Figure <a href="PopModels.html#fig:CAGEANPlot">10.2</a>). It is essential to keep in mind that this analysis is being done with an assumed rate of natural mortality. The results of such an analysis, including credible intervals, are conditional on the assumed value. In this case, natural mortality is fixed at the correct value, so these results show the best case in terms of accuracy and precision.</p>
<div class="figure"><span style="display:block;" id="fig:CAGEANPlot"></span>
<img src="bookdown_files/figure-html/CAGEANPlot-1.png" alt="Estimates of fishing mortality (left) and total abundance (right) from a stock assessment model fitted to fishery and survey catch-at-age matrices. True values and model estimates are shown as dotted and solid lines respectively." width="90%" />
<p class="caption">
FIGURE 10.2: Estimates of fishing mortality (left) and total abundance (right) from a stock assessment model fitted to fishery and survey catch-at-age matrices. True values and model estimates are shown as dotted and solid lines respectively.
</p>
</div>
<p>Recruitment in this simulation was assumed to vary about a fixed mean, but the model could be extended to include a relationship between spawning stock and recruitment, as in Section <a href="Recruit.html#Recruit-Fit">9.1</a>. The analytical approach could then be modified to estimate the spawning stock-recruitment parameters internally <span class="citation">(<a href="#ref-brooks.deroba_2015">Brooks and Deroba 2015</a>)</span>.</p>
<p>When experimenting with alternative simulation settings, approximate estimates can be obtained using fewer updates (e.g., 20,000). Rhat values will typically exceed 1.1 but the estimates should show reasonable agreement with the true values. Final estimates can then be obtained using a sufficiently large value for the number of updates.</p>
</div>
<div id="exercises-7" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Exercises<a href="PopModels.html#exercises-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>For the two-age model (Section <a href="PopModels.html#TwoAge">10.1</a>), compare true and estimated total abundance using absolute relative errors (<code>abs((y-y.hat)/y)</code>) for five trials using capture probabilities of 0.1, 0.2, and 0.3. Would you recommend a field trial using a capture probability of 0.1?</p></li>
<li><p>For the stock assessment model (Section <a href="PopModels.html#CAGEAN">10.2</a>), set the number of updates at a modest level (e.g., 20,000) and compare the level of convergence when fishing mortality is consistently low (e.g., 0.0-0.1) or high (1.0-1.1). Why is there a difference in how readily convergence is achieved for the two cases?</p></li>
</ol>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-brooks.deroba_2015" class="csl-entry">
Brooks, Elizabeth N., and Jonathan J. Deroba. 2015. <span>“When <span>‘Data’</span> Are Not Data: The Pitfalls of Post Hoc Analyses That Use Stock Assessment Model Output.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 72 (4): 634–41. <a href="https://doi.org/10.1139/cjfas-2014-0231">https://doi.org/10.1139/cjfas-2014-0231</a>.
</div>
<div id="ref-conn.etal_2008" class="csl-entry">
Conn, Paul B., Duane R. Diefenbach, Jeffrey L. Laake, Mark A. Ternent, and Gary C. White. 2008. <span>“Bayesian Analysis of Wildlife Age-at-Harvest Data.”</span> <em>Biometrics</em> 64 (4): 1170–77. <a href="https://doi.org/10.1111/j.1541-0420.2008.00987.x">https://doi.org/10.1111/j.1541-0420.2008.00987.x</a>.
</div>
<div id="ref-deriso.etal_1985" class="csl-entry">
Deriso, R. B., T. J. Quinn II, and P. R. Neal. 1985. <span>“Catch-Age Analysis with Auxiliary Information.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 42 (4): 815–24. <a href="https://doi.org/10.1139/f85-104">https://doi.org/10.1139/f85-104</a>.
</div>
<div id="ref-fielder.bence_2014" class="csl-entry">
Fielder, David G., and James R. Bence. 2014. <span>“Integration of Auxiliary Information in Statistical Catch-at-Age (<span>SCA</span>) Analysis of the <span>Saginaw Bay</span> Stock of Walleye in <span>Lake Huron</span>.”</span> <em>North American Journal of Fisheries Management</em> 34 (5): 970–87. <a href="https://doi.org/10.1080/02755947.2014.938141">https://doi.org/10.1080/02755947.2014.938141</a>.
</div>
<div id="ref-fournier.etal_2012" class="csl-entry">
Fournier, David A., Hans J. Skaug, Johnoel Ancheta, James Ianelli, Arni Magnusson, Mark N. Maunder, Anders Nielsen, and John Sibert. 2012. <span>“<span>AD Model Builder</span>: Using Automatic Differentiation for Statistical Inference of Highly Parameterized Complex Nonlinear Models.”</span> <em>Optimization Methods and Software</em> 27 (2): 233–49. <a href="https://doi.org/10.1080/10556788.2011.597854">https://doi.org/10.1080/10556788.2011.597854</a>.
</div>
<div id="ref-kéry.schaub_2012" class="csl-entry">
Kéry, Marc, and Michael Schaub. 2012. <em>Bayesian <span>Population Analysis</span> Using <span>WinBUGS</span>: <span>A Hierarchical Perspective</span></em>. 1st ed. Amsterdam: Academic Press.
</div>
<div id="ref-lorenzen1996" class="csl-entry">
Lorenzen, K. 1996. <span>“The Relationship Between Body Weight and Natural Mortality in Juvenile and Adult Fish: A Comparison of Natural Ecosystems and Aquaculture.”</span> <em>Journal of Fish Biology</em> 49 (4): 627–42. <a href="https://doi.org/10.1111/j.1095-8649.1996.tb00060.x">https://doi.org/10.1111/j.1095-8649.1996.tb00060.x</a>.
</div>
<div id="ref-maunder.punt_2013" class="csl-entry">
Maunder, Mark N., and Andre E. Punt. 2013. <span>“A Review of Integrated Analysis in Fisheries Stock Assessment.”</span> <em>Fisheries Research</em> 142 (May): 61–74. <a href="https://doi.org/10.1016/j.fishres.2012.07.025">https://doi.org/10.1016/j.fishres.2012.07.025</a>.
</div>
<div id="ref-methot.wetzell_2013" class="csl-entry">
Methot, Richard D., Jr., and Chantell R. Wetzell. 2013. <span>“Stock Synthesis: <span>A</span> Biological and Statistical Framework for Fish Stock Assessment and Fishery Management.”</span> <em>Fisheries Research</em> 142: 86–99. https://doi.org/<a href="https://doi-org.prox.lib.ncsu.edu/10.1016/j.fishres.2012.10.012">https://doi-org.prox.lib.ncsu.edu/10.1016/j.fishres.2012.10.012</a>.
</div>
<div id="ref-millar.meyer2000" class="csl-entry">
Millar, Russell B, and Renate Meyer. 2000. <span>“Bayesian State-Space Modeling of Age-Structured Data: Fitting a Model Is Just the Beginning.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 57 (1): 43–50. <a href="https://doi.org/10.1139/f99-169">https://doi.org/10.1139/f99-169</a>.
</div>
<div id="ref-quinn.deriso_1999" class="csl-entry">
Quinn, Terrance J., and Richard B. Deriso. 1999. <em>Quantitative <span>Fish Dynamics</span></em>. Oxford: Oxford University Press.
</div>
<div id="ref-ricker1975" class="csl-entry">
Ricker, William Edwin. 1975. <em>Computation and Interpretation of Biological Statistics of Fish Populations</em>. 191. Ottawa: <span>Dept. of Fisheries and Oceans : Minister of Supply and Services Canada</span>.
</div>
<div id="ref-schaub.etal_2024" class="csl-entry">
Schaub, Michael, Mark N. Maunder, Marc Kéry, James T. Thorson, Eiren K. Jacobson, and André E. Punt. 2024. <span>“Lessons to Be Learned by Comparing Integrated Fisheries Stock Assessment Models (<span>SAMs</span>) with Integrated Population Models (<span>IPMs</span>).”</span> <em>Fisheries Research</em> 272 (April): 106925. <a href="https://doi.org/10.1016/j.fishres.2023.106925">https://doi.org/10.1016/j.fishres.2023.106925</a>.
</div>
<div id="ref-then.etal_2015" class="csl-entry">
Then, Amy Y, John M Hoenig, Norman G Hall, David A Hewitt, and Handling editor: Ernesto Jardim. 2015. <span>“Evaluating the Predictive Performance of Empirical Estimators of Natural Mortality Rate Using Information on over 200 Fish Species.”</span> <em>ICES Journal of Marine Science</em> 72 (1): 82–92. <a href="https://doi.org/10.1093/icesjms/fsu136">https://doi.org/10.1093/icesjms/fsu136</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Recruit.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="FinalThoughts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/10_IntegratedPopModels.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
